version: '3'

run: when_changed

vars:
  PRETTIER_ARGS: --ignore-path .gitignore --check '**/*'.{cjs,js,json,ts,html,md,yaml} '!pnpm-lock.yaml'
  ESLINT_ARGS: --ignore-path .gitignore --max-warnings 0 --ext ts,js,cjs

tasks:
  clean:
    cmd: tsc --build --clean

  build:
    aliases:
      - b
    cmd: tsc --build --verbose

  build:watch:
    aliases:
      - bw
    cmd: tsc --build --verbose --watch

  format:check:
    cmd: prettier {{.PRETTIER_ARGS}}

  format:fix:
    cmd: prettier {{.PRETTIER_ARGS}} --write

  syncpack:lint:check:
    cmd: syncpack lint

  syncpack:lint:fix:
    cmds:
      - syncpack fix-mismatches
      - syncpack lint

  eslint:lint-folders:check:
    internal: true
    requires:
      vars:
        - NAMES
    cmd: eslint {{.ESLINT_ARGS}} {{.NAMES}}

  eslint:lint-folders:fix:
    internal: true
    requires:
      vars:
        - NAMES
    cmd: eslint {{.ESLINT_ARGS}} {{.NAMES}} --fix

  execute-script:
    internal: true
    requires:
      vars:
        - SCRIPT
    cmd: node --experimental-loader @intertwine/dev-loader/index.js {{.SCRIPT}}
